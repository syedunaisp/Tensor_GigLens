// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  clerkId       String?   @unique
  name          String?
  email         String    @unique
  password      String?
  role          String    @default("gig_worker") // "gig_worker", "admin"
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  snapshots       FinancialSnapshot[]
  recommendations Recommendations[]
  forecasts       Forecast[]
}

model FinancialSnapshot {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  sector          String?  // e.g., "Delivery", "Rideshare"
  stage           String?  // e.g., "Stable", "Struggling"
  
  revenue         Float
  expenses        Float
  ebitda          Float
  growth          Float    // Month-over-month growth %
  customers       Int      // Number of rides/deliveries
  rate            Float    // Avg rate per task
  months          Int      // Data span in months
  
  margin          Float    // Profit margin %
  liquidityRatio  Float    // Cash / Monthly Expenses
  
  createdAt       DateTime @default(now())
}

model Recommendations {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  segment         String   // e.g., "Stable Compounding Earners"
  score           Float    // GigLens Score (0-100)
  
  leakAreas       Json     // Array of strings or objects describing leaks
  safeEmi         Float    // Recommended max EMI
  suggestedBudget Float    // Recommended monthly budget
  
  createdAt       DateTime @default(now())
}

model Forecast {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  baseForecast       Json  // Array of values for 30 days
  optimisticForecast Json
  stressedForecast   Json
  
  safeDays           Int   // Number of days cash runway
  dailySaveTarget    Float // Amount to save daily
  
  createdAt       DateTime @default(now())
}
